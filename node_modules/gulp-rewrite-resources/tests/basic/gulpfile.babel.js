import del from 'del';
import gulp from 'gulp';
import rewriteResources from '../../index';

// test...

// process stylesheet files and rewrite
gulp.task('stylesheet', () => {
  return gulp.src('src/**/*.css')
    .pipe(rewriteResources.resources({base: 'css'}))
    .pipe(gulp.dest('built'));
});

// process javascript files and rewrite
gulp.task('javascript', () => {
  return gulp.src('src/**/*.js')
    .pipe(rewriteResources.resources({base: 'js'}))
    .pipe(gulp.dest('built/js'));
});

// process index.html and rewrite to reference the rewritten resources
gulp.task('html', () => {
  return gulp.src('src/index.html')
    .pipe(rewriteResources.revisions())
    .pipe(gulp.dest('built'));
});

gulp.task('cleanup', (done) => {
  del.sync('built/**/*');
  done();
});

gulp.task('default', gulp.series('cleanup', 'stylesheet', 'javascript', 'html'));
